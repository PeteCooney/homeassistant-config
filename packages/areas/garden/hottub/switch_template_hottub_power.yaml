switch:
  - platform: template
    switches:
      hottub_power:
        availability_template: "{{ states('sensor.hottub_online') }}"
        unique_id: hottub_power
        friendly_name: Hot Tub Power
        icon_template: mdi:power
        value_template: >
          {% if state_attr('sensor.hottub_status', 'power') == 1 %}
            on
          {% else %}
            off
          {% endif %}
        turn_on:
          - service: rest_command.hottub_command
            data: 
              command: turn_on
              api_did: !secret hottub_api_did
              payload: ""
          - delay: 00:00:05
          - service: homeassistant.update_entity
            entity_id: sensor.hottub_status
        turn_off:
          - service: rest_command.hottub_command
            data: 
              command: turn_off
              api_did: !secret hottub_api_did
              payload: ""
          - delay: 00:00:05
          - service: homeassistant.update_entity
            entity_id: sensor.hottub_status
